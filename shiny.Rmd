---
title: "R Studio - Shiny"
output: 
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    theme: flatly
---

$~$

# Shiny app

Here is the basic set up for a Shiny app.

```{r}
library(shiny)

ui <- fluidPage()

server <- function(input, output) {}

shinyApp(ui = ui, server = server)
```

$~$

(**All these code examples can be used in R Studio: just start up the program, create a Single file (app.R), and copy and paste the code.**)

$~$

Let's create a basic map using Shiny. 

```{r message = FALSE}
library(shiny)
library(leaflet)

ui <- fluidPage(leafletOutput("map"))

server <- function(input, output, session) {
  
  output$map <- renderLeaflet({
    library(leaflet)
    leaflet() %>%
      addTiles()})}

shinyApp(ui, server)
```

$~$

# View and basemap

Let's change the basemap and set the view.

```{r message = FALSE}
library(shiny)
library(leaflet)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    library(leaflet)
    leaflet() %>%
      setView(lng = -15, lat = 20, zoom = 1) %>%
      addTiles() %>%
      addProviderTiles(providers$Esri.WorldImagery)})}

shinyApp(ui, server)
```

$~$

# Marker

Using the example from the R Studio [section](https://marinespatialviz.github.io/marinespatialviz/rstudio.html#marker), let's add a marker. 

```{r message = FALSE}
library(shiny)
library(leaflet)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    library(leaflet)
    leaflet() %>%
      addTiles() %>%
      setView(lng = 142, lat = 11, zoom = 3) %>%
      addMarkers(lng = 142.1999992, lat = 11.3499986) %>%
      addProviderTiles(providers$Esri.OceanBasemap)})}

shinyApp(ui, server)
```

$~$

## Pop-up

Let's add a pop-up to the marker. 

```{r message = FALSE}
library(shiny)
library(leaflet)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    leaflet() %>%
    addTiles() %>%
    setView(lng = 142, lat = 11, zoom = 3) %>%
    addMarkers(lng = 142.1999992, lat = 11.3499986, popup = 'Mariana Trench') %>%
    addProviderTiles(providers$CartoDB.Positron)})}

shinyApp(ui, server)
```

$~$

## Tooltip

```{r message = FALSE}
library(shiny)
library(leaflet)
library(htmltools)

df <- read.csv(textConnection(
  "Name,Lat,Long
  Mariana Trench, 11.3499986, 142.1999992 "))

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    leaflet(df) %>% 
      addTiles() %>%
      setView(lng = 142, lat = 11, zoom = 3) %>%
      addMarkers(~Long, ~Lat, label = ~htmlEscape(Name)) %>%
      addProviderTiles(providers$CartoDB.Positron)})}

shinyApp(ui, server)
```

$~$

## Circle marker

Change to marker to a circle marker. 

```{r message = FALSE}
library(shiny)
library(leaflet)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    leaflet() %>%
    addTiles() %>%
    setView(lng = 142, lat = 11, zoom = 3) %>%
    addCircleMarkers(lng = 142.1999992, lat = 11.3499986, radius = 6, fillOpacity = .5, color = 'green') %>%
    addProviderTiles(providers$CartoDB.Positron)})}

shinyApp(ui, server)
```

$~$

## Costum marker

Let's add the submarine.

```{r message = FALSE}
library(shiny)
library(leaflet)

subIcon <- makeIcon(iconUrl = "https://image.flaticon.com/icons/png/512/190/190006.png",
                    iconWidth = 100, iconHeight = 95)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    leaflet() %>%
    addTiles() %>%
    setView(lng = 142, lat = 11, zoom = 3) %>%
    addMarkers(lng = 142.1999992, lat = 11.3499986, icon = subIcon) %>%
    addProviderTiles(providers$CartoDB.Positron)})}

shinyApp(ui, server)
```

$~$

# Polyline

Let's add the Equator to the map. 

```{r message = FALSE}
library(shiny)
library(leaflet)

x = c(-180, 180)
y = c(0, 0)
e = data.frame(x, y)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    library(leaflet)
    leaflet() %>%
      addTiles() %>%
      setView(lng = 0, lat = 0, zoom = 2) %>%
      addPolylines(lng = e$x, lat = e$y, color = "red") %>%
      addProviderTiles(providers$Esri.OceanBasemap)})}

shinyApp(ui, server)
```

$~$

# Polygon

Let's also highlight the tropics adding a polygon. 

```{r message = FALSE}
library(shiny)
library(leaflet)

x = c(-180, 180, 180, -180)
y = c(23.5, 23.5, -23.5, -23.5)
e = data.frame(x, y)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    library(leaflet)
      leaflet() %>%
      addTiles() %>%
      setView(lng = 0, lat = 0, zoom = 2) %>%
      addPolygons(lng = e$x, lat = e$y, color = "orange", fillOpacity = .5) %>% 
      addProviderTiles(providers$Hydda.Base)})}

shinyApp(ui, server)
```

$~$

# Layer control

Here is function for the layer control. 

```{r message = FALSE}
library(shiny)
library(leaflet)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    library(leaflet)
     leaflet() %>%
       addTiles() %>%
       setView(lng = 0, lat = 0, zoom = 2) %>%
       addProviderTiles(providers$Hydda.Base, group = "Hydda") %>%
       addProviderTiles(providers$CartoDB.DarkMatter, group = "Carto") %>%
       addLayersControl(baseGroups = c("Hydda", "Carto"),
                        options = layersControlOptions(collapsed = TRUE))})}

shinyApp(ui, server)
```

$~$

## Layer control with icon

```{r message = FALSE}
library(shiny)
library(leaflet)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
dolphinIcon <- makeAwesomeIcon(icon = 'glyphicon-map-marker', markerColor = 'black', iconColor = 'white', library = "glyphicon")

groups <- c("Dolphin" <- "<div style='position: relative; display: inline-block' class='awesome-marker-icon-black awesome-marker'><i class='glyphicon glyphicon-map-marker icon-white '></i></div>Dolphin")

  output$mymap <- renderLeaflet({
    library(leaflet)
     leaflet() %>% 
       addTiles() %>%
       addAwesomeMarkers(lng = -0.221, lat = 51.4709, icon = dolphinIcon, group = groups) %>%
       addLayersControl(
         overlayGroups = groups,
         options = layersControlOptions(collapsed = FALSE))})}

shinyApp(ui, server)
```

$~$

# WMS tile

Here is the same example for the WMS tile in Shiny.

```{r message = FALSE}
library(shiny)
library(leaflet)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    library(leaflet)
     leaflet() %>% 
  addTiles() %>% 
  setView(1, 51, zoom = 3) %>%
  addWMSTiles(
    "http://213.122.160.75/scripts/mapserv.exe?map=D:/Websites/MeshAtlantic/map/MESHAtlantic.map",
    layers = "EUSMMSFD",
    options = WMSTileOptions(format = "image/png", transparent = TRUE),
    attribution = "EUSeaMap2 Broad-Scale Predictive Habitat Map © 2016 EMODnet"
  )})}

shinyApp(ui, server)
```

$~$

# Showing coordinate information

```{r, fig.width = 8.4, fig.height = 6}
library(mapview)
library(leaflet)
library(shiny)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
    library(leaflet)
     leaflet() %>%
       addTiles() %>% 
        setView(0, 0, zoom = 3) %>%
       addMouseCoordinates(style = "basic")})}

shinyApp(ui, server)
```

$~$

# Adding geotagged pictures to a map

Here, the same example is used as for R Studio. In addition, a title was also added to the app. 

```{r}
library(shiny)

ui <- fluidPage(
  titlePanel("Plastic pollution on beaches"),
  leafletOutput("mymap"))

server <- function(input, output, session) {
  
  content1 <- paste(sep = "<br/>",  
                    "<img src=https://c1.staticflickr.com/5/4435/36028473794_62c4e88482_b.jpg'   
                    style='width:280px;height:200px;'>", "Oarai beach, Japan",
                    "Plastic pieces")
  scene1 <- read_exif('1.jpg', recursive = FALSE) 
  x1 <- scene1$GPSLongitude  
  y1 <- scene1$GPSLatitude  
  
  content2 <- paste(sep = "<br/>",  
                    "<img src='https://c1.staticflickr.com/5/4364/36053908023_67500b4bd6_b.jpg'   
                    style='width:200px;height:280px;'>",
                    "Santa Monica",
                    "Small plastic bag")
  scene2 <- read_exif('2.jpg', recursive = FALSE)  
  x2 <- scene2$GPSLongitude  
  y2 <- scene2$GPSLatitude  
  content3 <- paste(sep = "<br/>",  
                    "<img src='https://c1.staticflickr.com/5/4440/36862734845_8c485429e7_b.jpg'   
                    style='width:280px;height:200px;'>",
                    "Bondi beach",
                    "Small plastic pieces")
  scene3 <- read_exif('3.jpg', recursive = FALSE) 
  x3 <- scene3$GPSLongitude  
  y3 <- scene3$GPSLatitude  
  content4 <- paste(sep = "<br/>",  
                    "<img src='https://c1.staticflickr.com/5/4391/36054414233_b3f762af22_b.jpg'   
                    style='width:200px;height:280px;'>",
                    "West Wittering",
                    "Plastic pieces")
  scene4 <- read_exif('4.jpg', recursive = FALSE)  
  x4 <- scene4$GPSLongitude  
  y4 <- scene4$GPSLatitude  
  
  output$mymap <- renderLeaflet({
    library(leaflet)
    library(exifr)
    
    leaflet() %>%
      addProviderTiles("Hydda.Full") %>%
      addMarkers(x1, y1, popup = content1) %>%
      addMarkers(x2, y2, popup = content2) %>%
      addMarkers(x3, y3, popup = content3) %>%
      addMarkers(x4, y4, popup = content4)})}

shinyApp(ui, server)
```

$~$

# Home button

```{r, fig.width = 8.4, fig.height = 6}
library(shiny)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
 
      library(mapview)
      library(leaflet)
      leaflet() %>% 
        addTiles() %>%
        setView(0, 0, zoom = 3) %>%
        addMouseCoordinates(style = "basic") %>%
         addEasyButton(easyButton(
              icon = "fa-globe",
              onClick = JS("function(btn, map){ map.setZoom(3);}")))
  })}

shinyApp(ui, server)
```

$~$

# Full screen button

```{r, fig.width = 8.4, fig.height = 6}
library(shiny)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
 
      library(mapview)
      library(leaflet)

      leaflet() %>%
        addTiles() %>%
        setView(0, 0, zoom = 3) %>%
        addMouseCoordinates(style = "basic") %>%
        addEasyButton(easyButton(
          icon = "fa-globe",
          onClick = JS("function(btn, map){ map.setZoom(3);}"))) %>%
        addFullscreenControl()})
}

shinyApp(ui, server)
```

$~$

# Locate button

```{r, fig.width = 8.4, fig.height = 6}
library(shiny)

ui <- fluidPage(leafletOutput("mymap"))

server <- function(input, output, session) {
  
  output$mymap <- renderLeaflet({
 
      library(leaflet)
      library(leaflet.extras)
      library(mapview)
      library(htmltools)
      library(htmlwidgets)

      leaflet() %>% 
        addTiles() %>%
        setView(0, 0, zoom = 2) %>%
        addMouseCoordinates(style = "basic") %>%
        addEasyButton(easyButton(
          icon = "fa-globe",
          onClick = JS("function(btn, map){ map.setZoom(3);}"))) %>%
        addEasyButton(easyButton(
          icon = "fa-crosshairs", title = "Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true}); }"))) %>%
        addFullscreenControl()})
}

shinyApp(ui, server)
```

$~$

<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>